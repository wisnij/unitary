Unit Database Data Files
========================

This directory contains the unit database files used to build the app's built-in unit registry.


Pipeline Overview
-----------------

~~~~
tool/gnu_units/definitions.units
        │
  [import_gnu_units]
        │
        ▼
units-parsed.json              units-supplementary.json
(importer-owned; generated)    (manually curated; checked in)
        │                               │
        └──────────[merge]──────────────┘
                        │  (inside generate_builtin_units)
                        ▼
                  units.json             (merged; checked in for codegen)
                        │
               [codegen — unchanged]
                        │
                        ▼
               builtin_units.dart
~~~~


Files
-----

### `units-supplementary.json` — manually maintained

Manually maintained supplementary data not derived from GNU Units: human-readable
descriptions, additional aliases, category assignments, and affine unit definitions
(e.g. temperature scales like Celsius and Fahrenheit).

**Edit this file** to add or update descriptions, aliases, categories, or affine
definitions. The supplementary data overlays the parsed data during codegen — any
field in the supplementary wins over the corresponding parsed field.

### `units-parsed.json` — generated by importer

Generated by `dart run tool/import_gnu_units.dart`. Contains importer-owned fields
only: `type`, `definition`, `gnuUnitsSource`, `source`, and type-specific fields
(`isDimensionless` for primitive, `target` for alias, `reason` for unsupported).

**Do not edit by hand.** Re-generated whenever the GNU Units definitions file is updated.

### `units.json` — generated by codegen

Generated by `dart run tool/generate_builtin_units.dart`. The recursive merge of
`units-parsed.json` and `units-supplementary.json`: supplementary fields overlay
parsed fields where both exist; supplementary-only entries (e.g. affine temperature
units) are added as-is; parsed-only entries appear unchanged.

**Do not edit by hand.** Re-generated whenever `units-parsed.json` or
`units-supplementary.json` changes.

### `builtin_units.dart` — generated by codegen

Generated by `dart run tool/generate_builtin_units.dart`. Dart source with `const`
unit objects, regenerated from `units.json`. Registered into `UnitRepository` at
app startup via `registerBuiltinUnits()`.

**Do not edit by hand.**


Workflow
--------

To update the unit database after changing the GNU Units definitions file:

~~~~ bash
dart run tool/import_gnu_units.dart        # → updates units-parsed.json
dart run tool/generate_builtin_units.dart  # → updates units.json + builtin_units.dart
flutter test --reporter failures-only      # verify tests pass
~~~~

To add metadata (descriptions, aliases, categories) for existing units:

1. Edit `units-supplementary.json` directly.
2. Run `dart run tool/generate_builtin_units.dart` to regenerate `units.json` and
   `builtin_units.dart`.
3. Run `flutter test --reporter failures-only` to verify.
